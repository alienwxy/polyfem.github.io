



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="A polyvalent C++ FEM library">
      
      
        <link rel="canonical" href="http://polyfem.github.io/polyfem/python_examples/">
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.1.0">
    
    
      
        <title>Jupyter tutorial - polyfem</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.11e41852.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#7cb342">
      
    
    
      <script src="../assets/javascripts/modernizr.20ef595d.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="light-green" data-md-color-accent="green">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#polyfem-tutorial" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="http://polyfem.github.io/polyfem/" title="polyfem" class="md-header-nav__button md-logo">
          
            <i class="md-icon"> </i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                polyfem
              </span>
              <span class="md-header-nav__topic">
                Jupyter tutorial
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/polyfem/polyfem/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      polyfem/polyfem
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="http://polyfem.github.io/polyfem/" title="polyfem" class="md-nav__button md-logo">
      
        <i class="md-icon"> </i>
      
    </a>
    polyfem
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/polyfem/polyfem/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      polyfem/polyfem
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      C++
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        C++
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../cxx_index/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tutorial/" title="Tutorial" class="md-nav__link">
      Tutorial
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../library/" title="Documentation" class="md-nav__link">
      Documentation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../documentation/" title="JSON api" class="md-nav__link">
      JSON api
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Python [beta]
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Python [beta]
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../python/" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Jupyter tutorial
      </label>
    
    <a href="./" title="Jupyter tutorial" class="md-nav__link md-nav__link--active">
      Jupyter tutorial
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#examples" title="Examples" class="md-nav__link">
    Examples
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#utility" title="Utility" class="md-nav__link">
    Utility
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#plate-hole" title="Plate hole" class="md-nav__link">
    Plate hole
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#plate-hole-with-high-order-mesh" title="Plate hole with High-Order Mesh" class="md-nav__link">
    Plate hole with High-Order Mesh
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torsion" title="Torsion" class="md-nav__link">
    Torsion
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fluid-simulation" title="Fluid simulation" class="md-nav__link">
    Fluid simulation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#time-dependent-simulation" title="Time dependent simulation" class="md-nav__link">
    Time dependent simulation
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../polyfempy_doc/" title="Docs" class="md-nav__link">
      Docs
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#examples" title="Examples" class="md-nav__link">
    Examples
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#utility" title="Utility" class="md-nav__link">
    Utility
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#plate-hole" title="Plate hole" class="md-nav__link">
    Plate hole
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#plate-hole-with-high-order-mesh" title="Plate hole with High-Order Mesh" class="md-nav__link">
    Plate hole with High-Order Mesh
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#torsion" title="Torsion" class="md-nav__link">
    Torsion
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fluid-simulation" title="Fluid simulation" class="md-nav__link">
    Fluid simulation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#time-dependent-simulation" title="Time dependent simulation" class="md-nav__link">
    Time dependent simulation
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/polyfem/polyfem.github.io/edit/docs/docs/python_examples.ipynb" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="polyfem-tutorial">Polyfem Tutorial<a class="headerlink" href="#polyfem-tutorial" title="Permanent link">&para;</a></h1>
<p>This is a jupyter notebook. The &ldquo;real&rdquo; notebook can be found <a href="https://github.com/polyfem/polyfem.github.io/blob/docs/docs/python_examples.ipynb">here</a>.</p>
<p>Polyfem relies on 3 main objects:</p>
<ol>
<li><code class="codehilite">Settings</code> that contains the main settings such discretization order (e.g., <span><span class="MathJax_Preview">P_1</span><script type="math/tex">P_1</script></span> or <span><span class="MathJax_Preview">P_2</span><script type="math/tex">P_2</script></span>), material parameters, formulation, etc.</li>
<li><code class="codehilite">Problem</code> that describe the problem you want to solve, that is the boundary conditions and right-hand side. There are some predefined problems, such as <code class="codehilite">DrivenCavity</code>, or generic problems, such as <code class="codehilite">GenericTensor</code>.</li>
<li><code class="codehilite">Solver</code> that is the actual FEM solver.</li>
</ol>
<p>The usage of specific problems is indented for benchmarking, in general you want to use the <code class="codehilite">GenericTensor</code> for tensor-based PDEs (e.g., elasticity) or <code class="codehilite">GenericScalar</code> for scalar PDEs (e.g., Poisson). </p>
<p>A typical use of Polyfem is:</p>
<div class="codehilite"><pre><span></span><span class="n">settings</span> <span class="o">=</span> <span class="n">polyfempy</span><span class="o">.</span><span class="n">Settings</span><span class="p">()</span>
<span class="c1"># set necessary settings</span>
<span class="c1"># e.g. settings.discr_order = 2</span>

<span class="n">settings</span><span class="o">.</span><span class="n">set_pde</span><span class="p">(</span><span class="n">polyfempy</span><span class="o">.</span><span class="n">PDEs</span><span class="o">.</span><span class="n">LinearElasticity</span><span class="p">)</span> <span class="c1"># or any other PDE</span>

<span class="n">problem</span> <span class="o">=</span> <span class="n">polyfempy</span><span class="o">.</span><span class="n">Problem</span><span class="p">()</span> <span class="c1"># or any other problem</span>
<span class="c1"># set problem related data</span>
<span class="c1"># e.g. problem.set_displacement(1, [0, 0], [True, False])</span>

<span class="n">settings</span><span class="o">.</span><span class="n">set_problem</span><span class="p">(</span><span class="n">problem</span><span class="p">)</span>

<span class="c1">#now we can create a solver and solve</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">polyfempy</span><span class="o">.</span><span class="n">Solver</span><span class="p">()</span>

<span class="n">solver</span><span class="o">.</span><span class="n">settings</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
<span class="n">solver</span><span class="o">.</span><span class="n">load_mesh_from_path</span><span class="p">(</span><span class="n">mesh_path</span><span class="p">)</span>

<span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
</pre></div>

<p><strong>Note 1</strong>: for legacy reasons Polyfem always normalizes the mesh (i.e., rescale it to lay in the <span><span class="MathJax_Preview">[0,1]^d</span><script type="math/tex">[0,1]^d</script></span> box, you can use <code class="codehilite">setting.normalize_mesh = False</code> to disable this feature.</p>
<p><strong>Note 2</strong>: the solution <span><span class="MathJax_Preview">u(x)</span><script type="math/tex">u(x)</script></span> of a FEM solver are the coefficients <span><span class="MathJax_Preview">u_i</span><script type="math/tex">u_i</script></span> you need to multiply the bases <span><span class="MathJax_Preview">\varphi_i(x)</span><script type="math/tex">\varphi_i(x)</script></span> with:
$$
u(x)=\sum u_i \varphi_i(x).
$$
The coefficients <span><span class="MathJax_Preview">u_i</span><script type="math/tex">u_i</script></span> are <strong>unrelated</strong> with the mesh vertices because of reordering of the nodes or high-order bases. For instance <span><span class="MathJax_Preview">P_2</span><script type="math/tex">P_2</script></span> bases have additional nodes on the edges which do not exist in the mesh.</p>
<p>For this reason Polyfem uses a <em>visualization mesh</em> where the solution is sampled at the vertices.
This mesh has two advantages: 
1. it solves the problem of nodes reordering and additional nodes in the same way
2. it provides a &ldquo;true&rdquo; visualization for high order solution by densely sampling each element (a <span><span class="MathJax_Preview">P_2</span><script type="math/tex">P_2</script></span> solution is a piecewise quadratic function which is visualized in a picewise linear fashion, thus the need of a dense element sampling).</p>
<p>To control the resolution of the visualization mesh use <code class="codehilite">settings.vismesh_rel_area</code>.</p>
<h2 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link">&para;</a></h2>
<p>Some imports for plotting</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">meshplot</span> <span class="kn">as</span> <span class="nn">mp</span>
</pre></div>

<p>algebra</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
</pre></div>

<p>and finally<code class="codehilite">polyfempy</code></p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">polyfempy</span> <span class="kn">as</span> <span class="nn">pf</span>
</pre></div>

<h3 id="utility">Utility<a class="headerlink" href="#utility" title="Permanent link">&para;</a></h3>
<p>Creates a quad mesh of <code class="codehilite">n_pts</code> x <code class="codehilite">n_pts</code> in the form of a regular grid</p>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">create_quad_mesh</span><span class="p">(</span><span class="n">n_pts</span><span class="p">):</span>
    <span class="n">extend</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n_pts</span><span class="p">)</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">extend</span><span class="p">,</span> <span class="n">extend</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;xy&#39;</span><span class="p">)</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">ravel</span><span class="p">()))</span>

    <span class="n">faces</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">([(</span><span class="n">n_pts</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_pts</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_pts</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">faces</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                <span class="n">j</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">n_pts</span><span class="p">,</span>
                <span class="n">j</span><span class="o">+</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">n_pts</span><span class="p">,</span>
                <span class="n">j</span><span class="o">+</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">n_pts</span><span class="p">,</span>
                <span class="n">j</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">n_pts</span>
            <span class="p">])</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">pts</span><span class="p">,</span> <span class="n">faces</span>
</pre></div>

<h2 id="plate-hole">Plate hole<a class="headerlink" href="#plate-hole" title="Permanent link">&para;</a></h2>
<p>This is the python version of the plate with hole example explained <a href="https://polyfem.github.io/tutorial/#boundary-conditions">here</a>.</p>
<p>Set the mesh path</p>
<div class="codehilite"><pre><span></span><span class="n">mesh_path</span> <span class="o">=</span> <span class="s2">&quot;plane_hole.obj&quot;</span>
</pre></div>

<p>create settings</p>
<div class="codehilite"><pre><span></span><span class="n">settings</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">Settings</span><span class="p">()</span>
</pre></div>

<p>pick linear <span><span class="MathJax_Preview">P_1</span><script type="math/tex">P_1</script></span> elements. If the mesh would be a quad it would be <span><span class="MathJax_Preview">Q_1</span><script type="math/tex">Q_1</script></span></p>
<div class="codehilite"><pre><span></span><span class="n">settings</span><span class="o">.</span><span class="n">discr_order</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>

<p>normalize the mesh to be in <span><span class="MathJax_Preview">[0,1]^2</span><script type="math/tex">[0,1]^2</script></span></p>
<div class="codehilite"><pre><span></span><span class="n">settings</span><span class="o">.</span><span class="n">normalize_mesh</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>

<p>and choose Young&rsquo;s modulus and poisson ratio</p>
<div class="codehilite"><pre><span></span><span class="n">settings</span><span class="o">.</span><span class="n">set_material_params</span><span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="mi">210000</span><span class="p">)</span>
<span class="n">settings</span><span class="o">.</span><span class="n">set_material_params</span><span class="p">(</span><span class="s2">&quot;nu&quot;</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
</pre></div>

<p>We are use a linear material model</p>
<div class="codehilite"><pre><span></span><span class="n">settings</span><span class="o">.</span><span class="n">set_pde</span><span class="p">(</span><span class="n">pf</span><span class="o">.</span><span class="n">PDEs</span><span class="o">.</span><span class="n">LinearElasticity</span><span class="p">)</span>
</pre></div>

<p>Next we setup the problem</p>
<div class="codehilite"><pre><span></span><span class="n">problem</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">Problem</span><span class="p">()</span>
</pre></div>

<p>sideset 1 has symetric boundary in <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span></p>
<div class="codehilite"><pre><span></span><span class="n">problem</span><span class="o">.</span><span class="n">set_x_symmetric</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

<p>sideset 4 has symmetric boundary in <span><span class="MathJax_Preview">y</span><script type="math/tex">y</script></span></p>
<div class="codehilite"><pre><span></span><span class="n">problem</span><span class="o">.</span><span class="n">set_y_symmetric</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>

<p>sideset 3 has a force of [100, 0] applied</p>
<div class="codehilite"><pre><span></span><span class="n">problem</span><span class="o">.</span><span class="n">set_force</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</pre></div>

<p>fianally set the problem</p>
<div class="codehilite"><pre><span></span><span class="n">settings</span><span class="o">.</span><span class="n">set_problem</span><span class="p">(</span><span class="n">problem</span><span class="p">)</span>
</pre></div>

<p>Solve!</p>
<div class="codehilite"><pre><span></span><span class="n">solver</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">Solver</span><span class="p">()</span>

<span class="n">solver</span><span class="o">.</span><span class="n">settings</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
<span class="n">solver</span><span class="o">.</span><span class="n">load_mesh_from_path</span><span class="p">(</span><span class="n">mesh_path</span><span class="p">)</span>

<span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
</pre></div>

<div class="codehilite"><pre><span></span>[2019-07-16 15:29:45.119] [polyfem] [info] Loading mesh...
[2019-07-16 15:29:45.119] [geogram] [info] Loading file plane_hole.obj...
[2019-07-16 15:29:45.131] [geogram] [info] (FP64) nb_v:8549 nb_e:0 nb_f:16797 nb_b:299 tri:1 dim:3
[2019-07-16 15:29:45.131] [geogram] [info] Attributes on vertices: point[3]
[2019-07-16 15:29:45.140] [polyfem] [info] mesh bb min [0.500183, 0.5], max [100.5, 50.5]
[2019-07-16 15:29:45.141] [polyfem] [info]  took 0.0210737s
[2019-07-16 15:29:45.142] [polyfem] [info] simplex_count:   16797
[2019-07-16 15:29:45.142] [polyfem] [info] regular_count:   0
[2019-07-16 15:29:45.142] [polyfem] [info] regular_boundary_count:  0
[2019-07-16 15:29:45.142] [polyfem] [info] simple_singular_count:   0
[2019-07-16 15:29:45.142] [polyfem] [info] multi_singular_count:    0
[2019-07-16 15:29:45.142] [polyfem] [info] boundary_count:  0
[2019-07-16 15:29:45.142] [polyfem] [info] multi_singular_boundary_count:   0
[2019-07-16 15:29:45.142] [polyfem] [info] non_regular_count:   0
[2019-07-16 15:29:45.142] [polyfem] [info] non_regular_boundary_count:  0
[2019-07-16 15:29:45.142] [polyfem] [info] undefined_count:     0
[2019-07-16 15:29:45.142] [polyfem] [info] total count:  16797
[2019-07-16 15:29:45.142] [polyfem] [info] Building isoparametric basis...
[2019-07-16 15:29:45.163] [polyfem] [info] Computing polygonal basis...
[2019-07-16 15:29:45.163] [polyfem] [info]  took 1.4877e-05s
[2019-07-16 15:29:45.164] [polyfem] [info] hmin: 0.420699
[2019-07-16 15:29:45.164] [polyfem] [info] hmax: 1.875
[2019-07-16 15:29:45.164] [polyfem] [info] havg: 0.831949
[2019-07-16 15:29:45.164] [polyfem] [info]  took 0.020509s
[2019-07-16 15:29:45.164] [polyfem] [info] flipped elements 0
[2019-07-16 15:29:45.164] [polyfem] [info] h: 1.875
[2019-07-16 15:29:45.164] [polyfem] [info] n bases: 8549
[2019-07-16 15:29:45.164] [polyfem] [info] n pressure bases: 0
[2019-07-16 15:29:45.164] [polyfem] [info] Assigning rhs...
[2019-07-16 15:29:45.164] [polyfem] [info]  took 0.00070312s
[2019-07-16 15:29:45.164] [polyfem] [info] Assembling stiffness mat...
[2019-07-16 15:29:45.197] [polyfem] [info]  took 0.0324238s
[2019-07-16 15:29:45.197] [polyfem] [info] sparsity: 236956/292341604
[2019-07-16 15:29:45.197] [polyfem] [info] Solving LinearElasticity with
[2019-07-16 15:29:45.197] [polyfem] [info] Hypre...
</pre></div>


<p>Get the solution</p>
<div class="codehilite"><pre><span></span><span class="p">[</span><span class="n">pts</span><span class="p">,</span> <span class="n">tets</span><span class="p">,</span> <span class="n">disp</span><span class="p">]</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">get_sampled_solution</span><span class="p">()</span>
</pre></div>

<p>diplace the mesh</p>
<div class="codehilite"><pre><span></span><span class="n">vertices</span> <span class="o">=</span> <span class="n">pts</span> <span class="o">+</span> <span class="n">disp</span>
</pre></div>

<p>and get the stresses</p>
<div class="codehilite"><pre><span></span><span class="n">mises</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">get_sampled_mises_avg</span><span class="p">()</span>
</pre></div>

<p>finally plot with the above code</p>
<div class="codehilite"><pre><span></span><span class="n">mp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">tets</span><span class="p">,</span> <span class="n">mises</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;wireframe&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">},</span> <span class="n">return_plot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>

<div class="codehilite"><pre><span></span>Renderer(camera=PerspectiveCamera(children=(DirectionalLight(color=&#39;white&#39;, intensity=0.6, position=(50.530025…
</pre></div>


<p>Note that we used <code class="codehilite">get_sampled_mises_avg</code> to get the Von Mises stresses because they depend on the Jacobian of the displacement which, becase we use <span><span class="MathJax_Preview">P_1</span><script type="math/tex">P_1</script></span> elements, is piece-wise constant. To avoid that effect in <code class="codehilite">get_sampled_mises_avg</code> the mises are averaged per vertex weighted by the area of the triangles. If you want the &ldquo;real&rdquo; mises just call</p>
<div class="codehilite"><pre><span></span><span class="n">mises</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">get_sampled_mises</span><span class="p">()</span>
<span class="n">mp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">tets</span><span class="p">,</span> <span class="n">mises</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;wireframe&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">},</span> <span class="n">return_plot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>

<div class="codehilite"><pre><span></span>Renderer(camera=PerspectiveCamera(children=(DirectionalLight(color=&#39;white&#39;, intensity=0.6, position=(50.530025…
</pre></div>


<h2 id="plate-hole-with-high-order-mesh">Plate hole with High-Order Mesh<a class="headerlink" href="#plate-hole-with-high-order-mesh" title="Permanent link">&para;</a></h2>
<p>This is the same example as before, but we use <code class="codehilite">wildmeshing</code> to create a curved mesh.</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">wildmeshing</span> <span class="kn">as</span> <span class="nn">wm</span>
<span class="n">mesh_path</span> <span class="o">=</span> <span class="s2">&quot;plane_hole.svg&quot;</span>

<span class="n">v</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">F_nodes</span> <span class="o">=</span> <span class="n">wm</span><span class="o">.</span><span class="n">triangulate_svg</span><span class="p">(</span><span class="n">mesh_path</span><span class="p">,</span> <span class="n">cut_outside</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">mute_log</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>

<div class="codehilite"><pre><span></span>1/1 n sub paths: 5
</pre></div>


<p>Now we proceed as before</p>
<div class="codehilite"><pre><span></span><span class="c1">#create settings</span>
<span class="n">settings</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">Settings</span><span class="p">()</span>

<span class="c1">#pick linear P_1 elements, even if the geometry is P_3</span>
<span class="n">settings</span><span class="o">.</span><span class="n">discr_order</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1">#Normalize</span>
<span class="n">settings</span><span class="o">.</span><span class="n">normalize_mesh</span> <span class="o">=</span> <span class="bp">True</span>

<span class="c1">#Material parameters</span>
<span class="n">settings</span><span class="o">.</span><span class="n">set_material_params</span><span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="mi">210000</span><span class="p">)</span>
<span class="n">settings</span><span class="o">.</span><span class="n">set_material_params</span><span class="p">(</span><span class="s2">&quot;nu&quot;</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>

<span class="c1">#Linear elasticity</span>
<span class="n">settings</span><span class="o">.</span><span class="n">set_pde</span><span class="p">(</span><span class="n">pf</span><span class="o">.</span><span class="n">PDEs</span><span class="o">.</span><span class="n">LinearElasticity</span><span class="p">)</span>
</pre></div>

<p>Next we setup the problem as before</p>
<div class="codehilite"><pre><span></span><span class="n">problem</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">Problem</span><span class="p">()</span>

<span class="c1">#sideset 1 is symmetric in x</span>
<span class="n">problem</span><span class="o">.</span><span class="n">set_x_symmetric</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1">#sideset 4 is symmetric in y</span>
<span class="n">problem</span><span class="o">.</span><span class="n">set_y_symmetric</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

<span class="c1">#sideset 3 has a force of [100, 0] applied</span>
<span class="n">problem</span><span class="o">.</span><span class="n">set_force</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</pre></div>

<p>fianally set the problem</p>
<div class="codehilite"><pre><span></span><span class="n">settings</span><span class="o">.</span><span class="n">set_problem</span><span class="p">(</span><span class="n">problem</span><span class="p">)</span>
</pre></div>

<p>Create the solver and load the high-order mesh, the only difference with respect to before</p>
<div class="codehilite"><pre><span></span><span class="n">solver</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">Solver</span><span class="p">()</span>

<span class="n">solver</span><span class="o">.</span><span class="n">settings</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
<span class="n">solver</span><span class="o">.</span><span class="n">set_high_order_mesh</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">F_nodes</span><span class="p">)</span>
</pre></div>

<div class="codehilite"><pre><span></span>[2019-07-16 15:29:47.764] [polyfem] [info] Loading mesh...
[2019-07-16 15:29:47.764] [polyfem] [info] mesh bb min [0, 0], max [1, 0.5]
[2019-07-16 15:29:47.764] [polyfem] [info]  took 3.5333e-05s
</pre></div>


<p>And finally, solve!</p>
<div class="codehilite"><pre><span></span><span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
</pre></div>

<div class="codehilite"><pre><span></span>[2019-07-16 15:29:47.776] [polyfem] [info] simplex_count:   314
[2019-07-16 15:29:47.776] [polyfem] [info] regular_count:   0
[2019-07-16 15:29:47.776] [polyfem] [info] regular_boundary_count:  0
[2019-07-16 15:29:47.776] [polyfem] [info] simple_singular_count:   0
[2019-07-16 15:29:47.776] [polyfem] [info] multi_singular_count:    0
[2019-07-16 15:29:47.776] [polyfem] [info] boundary_count:  0
[2019-07-16 15:29:47.776] [polyfem] [info] multi_singular_boundary_count:   0
[2019-07-16 15:29:47.776] [polyfem] [info] non_regular_count:   0
[2019-07-16 15:29:47.776] [polyfem] [info] non_regular_boundary_count:  0
[2019-07-16 15:29:47.776] [polyfem] [info] undefined_count:     0
[2019-07-16 15:29:47.776] [polyfem] [info] total count:  314
[2019-07-16 15:29:47.776] [polyfem] [info] Building not isoparametric basis...
[2019-07-16 15:29:47.777] [polyfem] [info] Computing polygonal basis...
[2019-07-16 15:29:47.777] [polyfem] [info]  took 6.363e-06s
[2019-07-16 15:29:47.777] [polyfem] [info] hmin: 0.0341246
[2019-07-16 15:29:47.777] [polyfem] [info] hmax: 0.0904418
[2019-07-16 15:29:47.777] [polyfem] [info] havg: 0.0597291
[2019-07-16 15:29:47.777] [polyfem] [info]  took 0.000643824s
[2019-07-16 15:29:47.777] [polyfem] [info] flipped elements 0
[2019-07-16 15:29:47.777] [polyfem] [info] h: 0.0904418
[2019-07-16 15:29:47.777] [polyfem] [info] n bases: 183
[2019-07-16 15:29:47.777] [polyfem] [info] n pressure bases: 0
[2019-07-16 15:29:47.777] [polyfem] [info] Assigning rhs...
[2019-07-16 15:29:47.777] [polyfem] [info]  took 0.000175593s
[2019-07-16 15:29:47.777] [polyfem] [info] Assembling stiffness mat...
[2019-07-16 15:29:47.778] [polyfem] [info]  took 0.00112067s
[2019-07-16 15:29:47.778] [polyfem] [info] sparsity: 4700/133956
[2019-07-16 15:29:47.778] [polyfem] [info] Solving LinearElasticity with
[2019-07-16 15:29:47.778] [polyfem] [info] Hypre...
</pre></div>


<p>Get and plot the solution, same as before</p>
<div class="codehilite"><pre><span></span><span class="p">[</span><span class="n">pts</span><span class="p">,</span> <span class="n">tets</span><span class="p">,</span> <span class="n">disp</span><span class="p">]</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">get_sampled_solution</span><span class="p">()</span>

<span class="c1">#diplace the mesh</span>
<span class="n">vertices</span> <span class="o">=</span> <span class="n">pts</span> <span class="o">+</span> <span class="n">disp</span>

<span class="c1">#get the stresses</span>
<span class="n">mises</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">get_sampled_mises_avg</span><span class="p">()</span>

<span class="c1">#plot</span>
<span class="n">mp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">tets</span><span class="p">,</span> <span class="n">mises</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;wireframe&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">},</span> <span class="n">return_plot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>

<div class="codehilite"><pre><span></span>Renderer(camera=PerspectiveCamera(children=(DirectionalLight(color=&#39;white&#39;, intensity=0.6, position=(0.5002871…
</pre></div>


<h2 id="torsion">Torsion<a class="headerlink" href="#torsion" title="Permanent link">&para;</a></h2>
<p>Non-linear example. We want to torque a 3D bar around the <span><span class="MathJax_Preview">z</span><script type="math/tex">z</script></span> direction.</p>
<p>The example is really similar as the one just above.</p>
<p>Sets the mesh, create a solver, and load the mesh.</p>
<p>In this case the mesh has already the correct size. We also choose a coarse visualization mesh</p>
<div class="codehilite"><pre><span></span><span class="n">mesh_path</span> <span class="o">=</span> <span class="s2">&quot;square_beam_h.HYBRID&quot;</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">Solver</span><span class="p">()</span>
<span class="n">solver</span><span class="o">.</span><span class="n">load_mesh_from_path</span><span class="p">(</span><span class="n">mesh_path</span><span class="p">,</span> <span class="n">normalize_mesh</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">vismesh_rel_area</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
</pre></div>

<div class="codehilite"><pre><span></span>[2019-07-16 15:29:47.929] [polyfem] [info] Loading mesh...
[2019-07-16 15:29:47.953] [polyfem] [info] mesh bb min [-10, -10, 0], max [10, 10, 100]
[2019-07-16 15:29:47.954] [polyfem] [info]  took 0.0248576s
</pre></div>


<p>We want to use the default sideset marking, top of the mesh is 5 and bottom is 6.</p>
<p>Let&rsquo;s verify. We first extract the sidesets: <code class="codehilite">p</code> are some point, <code class="codehilite">t</code> triangles, and <code class="codehilite">s</code> the sidesets from 1 to 6</p>
<div class="codehilite"><pre><span></span><span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">get_boundary_sidesets</span><span class="p">()</span>
</pre></div>

<p>Now we can plot it</p>
<div class="codehilite"><pre><span></span><span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">tmp</span><span class="p">[</span><span class="n">s</span><span class="o">==</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">tmp</span><span class="p">[</span><span class="n">s</span><span class="o">==</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">mp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;wireframe&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">},</span> <span class="n">return_plot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>

<div class="codehilite"><pre><span></span>Renderer(camera=PerspectiveCamera(children=(DirectionalLight(color=&#39;white&#39;, intensity=0.6, position=(0.0, 0.0,…
</pre></div>


<p>Now we create the settings, as before</p>
<div class="codehilite"><pre><span></span><span class="n">settings</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">Settings</span><span class="p">()</span>
</pre></div>

<p>It is an hex-mesh so we are using <span><span class="MathJax_Preview">Q_1</span><script type="math/tex">Q_1</script></span></p>
<div class="codehilite"><pre><span></span><span class="n">settings</span><span class="o">.</span><span class="n">discr_order</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>

<p>Choose Young&rsquo;s modulus and Poisson&rsquo;s ratio, as before</p>
<div class="codehilite"><pre><span></span><span class="n">settings</span><span class="o">.</span><span class="n">set_material_params</span><span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">settings</span><span class="o">.</span><span class="n">set_material_params</span><span class="p">(</span><span class="s2">&quot;nu&quot;</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">)</span>
</pre></div>

<p>Differently from before we want a non-linear material model: NeoHookean</p>
<div class="codehilite"><pre><span></span><span class="n">settings</span><span class="o">.</span><span class="n">set_pde</span><span class="p">(</span><span class="n">pf</span><span class="o">.</span><span class="n">PDEs</span><span class="o">.</span><span class="n">NonLinearElasticity</span><span class="p">)</span>
</pre></div>

<p>and we want to do 5 steps of incremental loading to avoid ambiguities in the rotation</p>
<div class="codehilite"><pre><span></span><span class="n">settings</span><span class="o">.</span><span class="n">nl_solver_rhs_steps</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>

<p>Now we setup problem with fixed sideset, rotating an number of tours</p>
<div class="codehilite"><pre><span></span><span class="n">problem</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">Torsion</span><span class="p">()</span>
</pre></div>

<p>sideset 5 is fixed</p>
<div class="codehilite"><pre><span></span><span class="n">problem</span><span class="o">.</span><span class="n">fixed_boundary</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>

<p>sideset 6 rotates</p>
<div class="codehilite"><pre><span></span><span class="n">problem</span><span class="o">.</span><span class="n">turning_boundary</span> <span class="o">=</span> <span class="mi">6</span>
</pre></div>

<p>around the <span><span class="MathJax_Preview">z</span><script type="math/tex">z</script></span>-axis (2)</p>
<div class="codehilite"><pre><span></span><span class="n">problem</span><span class="o">.</span><span class="n">axis_coordiante</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>

<p>by half a tour</p>
<div class="codehilite"><pre><span></span><span class="n">problem</span><span class="o">.</span><span class="n">n_turns</span> <span class="o">=</span> <span class="mf">0.5</span>
</pre></div>

<p>and set the problem and solve</p>
<div class="codehilite"><pre><span></span><span class="n">settings</span><span class="o">.</span><span class="n">set_problem</span><span class="p">(</span><span class="n">problem</span><span class="p">)</span>

<span class="c1">#solving!</span>
<span class="n">solver</span><span class="o">.</span><span class="n">settings</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>

<span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
</pre></div>

<div class="codehilite"><pre><span></span>[2019-07-16 15:29:48.101] [polyfem] [info] simplex_count:   0
[2019-07-16 15:29:48.101] [polyfem] [info] regular_count:   108
[2019-07-16 15:29:48.101] [polyfem] [info] regular_boundary_count:  356
[2019-07-16 15:29:48.101] [polyfem] [info] simple_singular_count:   0
[2019-07-16 15:29:48.101] [polyfem] [info] multi_singular_count:    0
[2019-07-16 15:29:48.101] [polyfem] [info] boundary_count:  0
[2019-07-16 15:29:48.101] [polyfem] [info] multi_singular_boundary_count:   0
[2019-07-16 15:29:48.101] [polyfem] [info] non_regular_count:   0
[2019-07-16 15:29:48.101] [polyfem] [info] non_regular_boundary_count:  0
[2019-07-16 15:29:48.101] [polyfem] [info] undefined_count:     0
[2019-07-16 15:29:48.101] [polyfem] [info] total count:  464
[2019-07-16 15:29:48.101] [polyfem] [info] Building isoparametric basis...
[2019-07-16 15:29:48.107] [polyfem] [info] Computing polygonal basis...
[2019-07-16 15:29:48.107] [polyfem] [info]  took 1.3212e-05s
[2019-07-16 15:29:48.107] [polyfem] [info] hmin: 3.4482
[2019-07-16 15:29:48.107] [polyfem] [info] hmax: 5
[2019-07-16 15:29:48.107] [polyfem] [info] havg: 4.41558
[2019-07-16 15:29:48.107] [polyfem] [info]  took 0.00593987s
[2019-07-16 15:29:48.107] [polyfem] [info] flipped elements 0
[2019-07-16 15:29:48.107] [polyfem] [info] h: 5
[2019-07-16 15:29:48.107] [polyfem] [info] n bases: 750
[2019-07-16 15:29:48.107] [polyfem] [info] n pressure bases: 0
[2019-07-16 15:29:48.107] [polyfem] [info] Assigning rhs...
[2019-07-16 15:29:48.108] [polyfem] [info]  took 0.000998475s
[2019-07-16 15:29:48.108] [polyfem] [info] Assembling stiffness mat...
[2019-07-16 15:29:48.108] [polyfem] [info]  took 3.524e-06s
[2019-07-16 15:29:48.108] [polyfem] [info] sparsity: 0/0
[2019-07-16 15:29:48.108] [polyfem] [info] Solving NeoHookean with
[2019-07-16 15:29:48.108] [polyfem] [info] t: 0.2 prev: 0 step: 0.2
[2019-07-16 15:29:55.892] [polyfem] [info] t: 0.4 prev: 0.2 step: 0.2
[2019-07-16 15:30:04.704] [polyfem] [info] t: 0.6 prev: 0.4 step: 0.2
[2019-07-16 15:30:12.333] [polyfem] [info] t: 0.8 prev: 0.6 step: 0.2
[2019-07-16 15:30:20.148] [polyfem] [info] t: 1 prev: 0.8 step: 0.2
</pre></div>


<p>takes approx 1 min because it is a complicated non-linear problem!</p>
<p>Get solution and stesses as before</p>
<p>Since we want to show only the surface there is no need of getting the whole volume, so we set <code class="codehilite">boundary_only</code> to <code class="codehilite">True</code></p>
<div class="codehilite"><pre><span></span><span class="p">[</span><span class="n">pts</span><span class="p">,</span> <span class="n">tets</span><span class="p">,</span> <span class="n">disp</span><span class="p">]</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">get_sampled_solution</span><span class="p">(</span><span class="n">boundary_only</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">vertices</span> <span class="o">=</span> <span class="n">pts</span> <span class="o">+</span> <span class="n">disp</span>
<span class="n">mises</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">get_sampled_mises_avg</span><span class="p">(</span><span class="n">boundary_only</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>

<p>and plot the 3d result!</p>
<div class="codehilite"><pre><span></span><span class="n">mp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">tets</span><span class="p">,</span> <span class="n">mises</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;wireframe&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">},</span> <span class="n">return_plot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>

<div class="codehilite"><pre><span></span>Renderer(camera=PerspectiveCamera(children=(DirectionalLight(color=&#39;white&#39;, intensity=0.6, position=(0.0, 0.0,…
</pre></div>


<h2 id="fluid-simulation">Fluid simulation<a class="headerlink" href="#fluid-simulation" title="Permanent link">&para;</a></h2>
<p>Create the mesh using the utility function</p>
<div class="codehilite"><pre><span></span><span class="n">pts</span><span class="p">,</span> <span class="n">faces</span> <span class="o">=</span> <span class="n">create_quad_mesh</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
</pre></div>

<p>create settings</p>
<div class="codehilite"><pre><span></span><span class="n">settings</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">Settings</span><span class="p">()</span>

<span class="n">settings</span><span class="o">.</span><span class="n">vismesh_rel_area</span> <span class="o">=</span> <span class="mf">0.001</span>
</pre></div>

<p>pick linear <span><span class="MathJax_Preview">Q_2</span><script type="math/tex">Q_2</script></span> elements for velocity and <span><span class="MathJax_Preview">Q_1</span><script type="math/tex">Q_1</script></span> for pressure</p>
<div class="codehilite"><pre><span></span><span class="n">settings</span><span class="o">.</span><span class="n">discr_order</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">settings</span><span class="o">.</span><span class="n">pressure_discr_order</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>

<p>Set the viscosity of the fluid</p>
<div class="codehilite"><pre><span></span><span class="n">settings</span><span class="o">.</span><span class="n">set_material_params</span><span class="p">(</span><span class="s2">&quot;viscosity&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>

<p>We select stokes as material model</p>
<div class="codehilite"><pre><span></span><span class="n">settings</span><span class="o">.</span><span class="n">set_pde</span><span class="p">(</span><span class="n">pf</span><span class="o">.</span><span class="n">PDEs</span><span class="o">.</span><span class="n">Stokes</span><span class="p">)</span>
</pre></div>

<p>The default solver do not support mixed formulation, we need to choose <code class="codehilite">UmfPackLU</code></p>
<div class="codehilite"><pre><span></span><span class="n">settings</span><span class="o">.</span><span class="n">set_advanced_option</span><span class="p">(</span><span class="s2">&quot;solver_type&quot;</span><span class="p">,</span> <span class="s2">&quot;Eigen::UmfPackLU&quot;</span><span class="p">)</span>
</pre></div>

<p>We use the standard <a href="https://www.cfd-online.com/Wiki/Lid-driven_cavity_problem">Driven Cavity</a> problem</p>
<div class="codehilite"><pre><span></span><span class="n">problem</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">DrivenCavity</span><span class="p">()</span>
</pre></div>

<p>we set the problem</p>
<div class="codehilite"><pre><span></span><span class="n">settings</span><span class="o">.</span><span class="n">set_problem</span><span class="p">(</span><span class="n">problem</span><span class="p">)</span>
</pre></div>

<p>We create the solver and set the settings</p>
<div class="codehilite"><pre><span></span><span class="n">solver</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">Solver</span><span class="p">()</span>
<span class="n">solver</span><span class="o">.</span><span class="n">settings</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</pre></div>

<p>This time we are using pts and faces instead of loading from the disk</p>
<div class="codehilite"><pre><span></span><span class="n">solver</span><span class="o">.</span><span class="n">set_mesh</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">faces</span><span class="p">)</span>
</pre></div>

<div class="codehilite"><pre><span></span>[2019-07-16 15:30:28.385] [polyfem] [info] Loading mesh...
[2019-07-16 15:30:28.385] [polyfem] [info] mesh bb min [0, 0], max [1, 1]
[2019-07-16 15:30:28.385] [polyfem] [info]  took 0.000239624s
</pre></div>


<p>Solve!</p>
<div class="codehilite"><pre><span></span><span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
</pre></div>

<div class="codehilite"><pre><span></span>[2019-07-16 15:30:28.393] [polyfem] [info] simplex_count:   0
[2019-07-16 15:30:28.393] [polyfem] [info] regular_count:   2209
[2019-07-16 15:30:28.393] [polyfem] [info] regular_boundary_count:  192
[2019-07-16 15:30:28.393] [polyfem] [info] simple_singular_count:   0
[2019-07-16 15:30:28.393] [polyfem] [info] multi_singular_count:    0
[2019-07-16 15:30:28.393] [polyfem] [info] boundary_count:  0
[2019-07-16 15:30:28.393] [polyfem] [info] multi_singular_boundary_count:   0
[2019-07-16 15:30:28.393] [polyfem] [info] non_regular_count:   0
[2019-07-16 15:30:28.393] [polyfem] [info] non_regular_boundary_count:  0
[2019-07-16 15:30:28.393] [polyfem] [info] undefined_count:     0
[2019-07-16 15:30:28.393] [polyfem] [info] total count:  2401
[2019-07-16 15:30:28.393] [polyfem] [info] Building not isoparametric basis...
[2019-07-16 15:30:28.408] [polyfem] [info] Computing polygonal basis...
[2019-07-16 15:30:28.408] [polyfem] [info]  took 1.4753e-05s
[2019-07-16 15:30:28.409] [polyfem] [info] hmin: 0.0204082
[2019-07-16 15:30:28.409] [polyfem] [info] hmax: 0.0204082
[2019-07-16 15:30:28.409] [polyfem] [info] havg: 0.0204082
[2019-07-16 15:30:28.409] [polyfem] [info]  took 0.0151766s
[2019-07-16 15:30:28.409] [polyfem] [info] flipped elements 0
[2019-07-16 15:30:28.409] [polyfem] [info] h: 0.0204082
[2019-07-16 15:30:28.409] [polyfem] [info] n bases: 9801
[2019-07-16 15:30:28.409] [polyfem] [info] n pressure bases: 2500
[2019-07-16 15:30:28.409] [polyfem] [info] Assigning rhs...
[2019-07-16 15:30:28.410] [polyfem] [info]  took 0.00184905s
[2019-07-16 15:30:28.410] [polyfem] [info] Assembling stiffness mat...
[2019-07-16 15:30:28.478] [polyfem] [info]  took 0.0677301s
[2019-07-16 15:30:28.478] [polyfem] [info] sparsity: 549568/488498404
[2019-07-16 15:30:28.478] [polyfem] [info] Solving Stokes with
[2019-07-16 15:30:28.478] [polyfem] [info] N5Eigen9UmfPackLUINS_12SparseMatrixIdLi0EiEEEE...
</pre></div>


<p>We now get the solution and the pressure</p>
<div class="codehilite"><pre><span></span><span class="p">[</span><span class="n">pts</span><span class="p">,</span> <span class="n">tris</span><span class="p">,</span> <span class="n">velocity</span><span class="p">]</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">get_sampled_solution</span><span class="p">()</span>
</pre></div>

<p>and plot it!</p>
<div class="codehilite"><pre><span></span><span class="n">each</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">tris</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">shading</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;wireframe&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">},</span> <span class="n">return_plot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">add_lines</span><span class="p">(</span><span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">pts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">each</span><span class="p">,:],</span> <span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">pts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">each</span><span class="p">,:]</span><span class="o">+</span><span class="n">velocity</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">pts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">each</span><span class="p">,:])</span>
<span class="n">p</span>
</pre></div>

<div class="codehilite"><pre><span></span>Renderer(camera=PerspectiveCamera(children=(DirectionalLight(color=&#39;white&#39;, intensity=0.6, position=(0.5, 0.5,…
</pre></div>


<h2 id="time-dependent-simulation">Time dependent simulation<a class="headerlink" href="#time-dependent-simulation" title="Permanent link">&para;</a></h2>
<p>Create the mesh using the utility function</p>
<div class="codehilite"><pre><span></span><span class="n">pts</span><span class="p">,</span> <span class="n">faces</span> <span class="o">=</span> <span class="n">create_quad_mesh</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
</pre></div>

<p>create settings</p>
<div class="codehilite"><pre><span></span><span class="n">settings</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">Settings</span><span class="p">()</span>
</pre></div>

<p>pick linear <span><span class="MathJax_Preview">Q_1</span><script type="math/tex">Q_1</script></span> elements.</p>
<div class="codehilite"><pre><span></span><span class="n">settings</span><span class="o">.</span><span class="n">discr_order</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>

<p>and choose Young&rsquo;s modulus and poisson ratio</p>
<div class="codehilite"><pre><span></span><span class="n">settings</span><span class="o">.</span><span class="n">set_material_params</span><span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">settings</span><span class="o">.</span><span class="n">set_material_params</span><span class="p">(</span><span class="s2">&quot;nu&quot;</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
</pre></div>

<p>We are use a linear material model</p>
<div class="codehilite"><pre><span></span><span class="n">settings</span><span class="o">.</span><span class="n">set_pde</span><span class="p">(</span><span class="n">pf</span><span class="o">.</span><span class="n">PDEs</span><span class="o">.</span><span class="n">LinearElasticity</span><span class="p">)</span>
</pre></div>

<p>For efficienty in the browser we select a coarse vis mesh</p>
<div class="codehilite"><pre><span></span><span class="n">settings</span><span class="o">.</span><span class="n">vismesh_rel_area</span> <span class="o">=</span> <span class="mf">0.001</span>
</pre></div>

<p>We simulate from 0 to 10s and 50 steps.</p>
<div class="codehilite"><pre><span></span><span class="n">settings</span><span class="o">.</span><span class="n">tend</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">settings</span><span class="o">.</span><span class="n">time_steps</span> <span class="o">=</span> <span class="mi">50</span>
</pre></div>

<p>Next we setup the problem, this doesnt have any parameters. It will&hellip;</p>
<div class="codehilite"><pre><span></span><span class="n">problem</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">Gravity</span><span class="p">()</span>
</pre></div>

<p>we set the problem</p>
<div class="codehilite"><pre><span></span><span class="n">settings</span><span class="o">.</span><span class="n">set_problem</span><span class="p">(</span><span class="n">problem</span><span class="p">)</span>
</pre></div>

<p>We create the solver and set the settings</p>
<div class="codehilite"><pre><span></span><span class="n">solver</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">Solver</span><span class="p">()</span>
<span class="n">solver</span><span class="o">.</span><span class="n">settings</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</pre></div>

<p>This time we are using <code class="codehilite">pts</code> and <code class="codehilite">faces</code> instead of loading from the disk</p>
<div class="codehilite"><pre><span></span><span class="n">solver</span><span class="o">.</span><span class="n">set_mesh</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">faces</span><span class="p">)</span>
</pre></div>

<div class="codehilite"><pre><span></span>[2019-07-16 15:30:28.997] [polyfem] [info] Loading mesh...
[2019-07-16 15:30:28.997] [polyfem] [info] mesh bb min [0, 0], max [1, 1]
</pre></div>


<p>Solve!</p>
<div class="codehilite"><pre><span></span><span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
</pre></div>

<div class="codehilite"><pre><span></span>[2019-07-16 15:30:29.006] [polyfem] [info] simplex_count:   0
[2019-07-16 15:30:29.006] [polyfem] [info] regular_count:   2209
[2019-07-16 15:30:29.006] [polyfem] [info] regular_boundary_count:  192
[2019-07-16 15:30:29.006] [polyfem] [info] simple_singular_count:   0
[2019-07-16 15:30:29.006] [polyfem] [info] multi_singular_count:    0
[2019-07-16 15:30:29.006] [polyfem] [info] boundary_count:  0
[2019-07-16 15:30:29.006] [polyfem] [info] multi_singular_boundary_count:   0
[2019-07-16 15:30:29.006] [polyfem] [info] non_regular_count:   0
[2019-07-16 15:30:29.006] [polyfem] [info] non_regular_boundary_count:  0
[2019-07-16 15:30:29.006] [polyfem] [info] undefined_count:     0
[2019-07-16 15:30:29.006] [polyfem] [info] total count:  2401
[2019-07-16 15:30:29.006] [polyfem] [info] Building isoparametric basis...
[2019-07-16 15:30:29.009] [polyfem] [info] Computing polygonal basis...
[2019-07-16 15:30:29.009] [polyfem] [info]  took 1.093e-05s
[2019-07-16 15:30:29.009] [polyfem] [info] hmin: 0.0204082
[2019-07-16 15:30:29.009] [polyfem] [info] hmax: 0.0204082
[2019-07-16 15:30:29.009] [polyfem] [info] havg: 0.0204082
[2019-07-16 15:30:29.009] [polyfem] [info]  took 0.00349494s
[2019-07-16 15:30:29.009] [polyfem] [info] flipped elements 0
[2019-07-16 15:30:29.009] [polyfem] [info] h: 0.0204082
[2019-07-16 15:30:29.009] [polyfem] [info] n bases: 2500
[2019-07-16 15:30:29.009] [polyfem] [info] n pressure bases: 0
[2019-07-16 15:30:29.009] [polyfem] [info] Assigning rhs...
[2019-07-16 15:30:29.018] [polyfem] [info]  took 0.00823314s
[2019-07-16 15:30:29.018] [polyfem] [info] Assembling stiffness mat...
[2019-07-16 15:30:29.036] [polyfem] [info]  took 0.0186862s
[2019-07-16 15:30:29.036] [polyfem] [info] sparsity: 87616/25000000
[2019-07-16 15:30:29.036] [polyfem] [info] Solving LinearElasticity with
[2019-07-16 15:30:29.044] [polyfem] [info] Hypre...
[2019-07-16 15:30:29.206] [polyfem] [info] 1/50
[2019-07-16 15:30:29.298] [polyfem] [info] 2/50
[2019-07-16 15:30:29.386] [polyfem] [info] 3/50
[2019-07-16 15:30:29.477] [polyfem] [info] 4/50
[2019-07-16 15:30:29.573] [polyfem] [info] 5/50
[2019-07-16 15:30:29.671] [polyfem] [info] 6/50
[2019-07-16 15:30:29.767] [polyfem] [info] 7/50
[2019-07-16 15:30:29.857] [polyfem] [info] 8/50
[2019-07-16 15:30:29.948] [polyfem] [info] 9/50
[2019-07-16 15:30:30.038] [polyfem] [info] 10/50
[2019-07-16 15:30:30.129] [polyfem] [info] 11/50
[2019-07-16 15:30:30.227] [polyfem] [info] 12/50
[2019-07-16 15:30:30.324] [polyfem] [info] 13/50
[2019-07-16 15:30:30.409] [polyfem] [info] 14/50
[2019-07-16 15:30:30.498] [polyfem] [info] 15/50
[2019-07-16 15:30:30.596] [polyfem] [info] 16/50
[2019-07-16 15:30:30.687] [polyfem] [info] 17/50
[2019-07-16 15:30:30.778] [polyfem] [info] 18/50
[2019-07-16 15:30:30.868] [polyfem] [info] 19/50
[2019-07-16 15:30:30.959] [polyfem] [info] 20/50
[2019-07-16 15:30:31.054] [polyfem] [info] 21/50
[2019-07-16 15:30:31.147] [polyfem] [info] 22/50
[2019-07-16 15:30:31.237] [polyfem] [info] 23/50
[2019-07-16 15:30:31.322] [polyfem] [info] 24/50
[2019-07-16 15:30:31.419] [polyfem] [info] 25/50
[2019-07-16 15:30:31.513] [polyfem] [info] 26/50
[2019-07-16 15:30:31.603] [polyfem] [info] 27/50
[2019-07-16 15:30:31.692] [polyfem] [info] 28/50
[2019-07-16 15:30:31.825] [polyfem] [info] 29/50
[2019-07-16 15:30:31.925] [polyfem] [info] 30/50
[2019-07-16 15:30:32.014] [polyfem] [info] 31/50
[2019-07-16 15:30:32.113] [polyfem] [info] 32/50
[2019-07-16 15:30:32.213] [polyfem] [info] 33/50
[2019-07-16 15:30:32.301] [polyfem] [info] 34/50
[2019-07-16 15:30:32.386] [polyfem] [info] 35/50
[2019-07-16 15:30:32.473] [polyfem] [info] 36/50
[2019-07-16 15:30:32.562] [polyfem] [info] 37/50
[2019-07-16 15:30:32.651] [polyfem] [info] 38/50
[2019-07-16 15:30:32.756] [polyfem] [info] 39/50
[2019-07-16 15:30:32.873] [polyfem] [info] 40/50
[2019-07-16 15:30:32.980] [polyfem] [info] 41/50
[2019-07-16 15:30:33.094] [polyfem] [info] 42/50
[2019-07-16 15:30:33.208] [polyfem] [info] 43/50
[2019-07-16 15:30:33.320] [polyfem] [info] 44/50
[2019-07-16 15:30:33.419] [polyfem] [info] 45/50
[2019-07-16 15:30:33.511] [polyfem] [info] 46/50
[2019-07-16 15:30:33.599] [polyfem] [info] 47/50
[2019-07-16 15:30:33.688] [polyfem] [info] 48/50
[2019-07-16 15:30:33.775] [polyfem] [info] 49/50
[2019-07-16 15:30:33.863] [polyfem] [info] 50/50
</pre></div>


<p>Get the solution and the mises</p>
<div class="codehilite"><pre><span></span><span class="n">pts</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">get_sampled_points_frames</span><span class="p">()</span>
<span class="n">tris</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">get_sampled_connectivity_frames</span><span class="p">()</span>
<span class="n">disp</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">get_sampled_solution_frames</span><span class="p">()</span>
<span class="n">mises</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">get_sampled_mises_avg_frames</span><span class="p">()</span>
</pre></div>

<p>Before the animation, let&rsquo;s plot the solution at frame 25</p>
<div class="codehilite"><pre><span></span><span class="n">frame</span> <span class="o">=</span> <span class="mi">25</span>

<span class="n">mp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pts</span><span class="p">[</span><span class="n">frame</span><span class="p">]</span><span class="o">+</span><span class="n">disp</span><span class="p">[</span><span class="n">frame</span><span class="p">],</span> <span class="n">tris</span><span class="p">[</span><span class="n">frame</span><span class="p">],</span> <span class="n">mises</span><span class="p">[</span><span class="n">frame</span><span class="p">],</span> <span class="n">shading</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;wireframe&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">},</span> <span class="n">return_plot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>

<div class="codehilite"><pre><span></span>Renderer(camera=PerspectiveCamera(children=(DirectionalLight(color=&#39;white&#39;, intensity=0.6, position=(0.5000000…
</pre></div>


<p>Now we are ready to do the animation</p>
<div class="codehilite"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pts</span><span class="p">[</span><span class="n">frame</span><span class="p">]</span><span class="o">+</span><span class="n">disp</span><span class="p">[</span><span class="n">frame</span><span class="p">],</span> <span class="n">tris</span><span class="p">[</span><span class="n">frame</span><span class="p">],</span> <span class="n">mises</span><span class="p">[</span><span class="n">frame</span><span class="p">],</span> <span class="n">shading</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;wireframe&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">},</span> <span class="n">return_plot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="nd">@mp.interact</span><span class="p">(</span><span class="n">frame</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mises</span><span class="p">)))</span>
<span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="n">frame</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="c1">#     p.update_object(vertices=pts[frame]+disp[frame]) </span>
    <span class="n">mp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pts</span><span class="p">[</span><span class="n">frame</span><span class="p">]</span><span class="o">+</span><span class="n">disp</span><span class="p">[</span><span class="n">frame</span><span class="p">],</span> <span class="n">tris</span><span class="p">[</span><span class="n">frame</span><span class="p">],</span> <span class="n">mises</span><span class="p">[</span><span class="n">frame</span><span class="p">],</span> <span class="n">shading</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;wireframe&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">},</span> <span class="n">plot</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
</pre></div>

<div class="codehilite"><pre><span></span>Renderer(camera=PerspectiveCamera(children=(DirectionalLight(color=&#39;white&#39;, intensity=0.6, position=(0.5000000…



interactive(children=(IntSlider(value=0, description=&#39;frame&#39;, max=51), Output()), _dom_classes=(&#39;widget-intera…
</pre></div>


<div class="codehilite"><pre><span></span>
</pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../python/" title="Home" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Home
              </span>
            </div>
          </a>
        
        
          <a href="../polyfempy_doc/" title="Docs" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Docs
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/polyfem" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.9e1f3b71.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
    
      
    
  </body>
</html>